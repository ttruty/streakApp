import{m as l,p as c,v as p,x as y}from"./chunk-7WHQ53J5.js";import{a as m,b as h}from"./chunk-JHI3MBHO.js";var f=(()=>{let r=class r{constructor(e){this.achievementService=e,this.STORAGE_KEY="user_inventory",this.GOLD_KEY="user_gold",this.LOOT_TABLE={gold_coin:{id:"gold_coin",name:"Gold Coin",icon:"cash-outline",type:"material",description:"Currency.",sellValue:1,rarity:"common",quantity:1},diamond:{id:"diamond",name:"Diamond",icon:"diamond-outline",type:"material",description:"Sparkling gem.",sellValue:100,rarity:"legendary",quantity:1},potion:{id:"potion",name:"Potion",icon:"flask-outline",type:"consumable",description:"Restores health.",sellValue:15,rarity:"rare",quantity:1},shield:{id:"shield",name:"Shield",icon:"shield-outline",type:"equipment",description:"Protection.",sellValue:10,rarity:"common",quantity:1},hammer:{id:"hammer",name:"Iron Hammer",icon:"hammer-outline",type:"equipment",description:"Good for smashing.",sellValue:20,rarity:"common",quantity:1},key:{id:"key",name:"Mystery Key",icon:"key-outline",type:"material",description:"Opens something...",sellValue:50,rarity:"rare",quantity:1},map:{id:"map",name:"Old Map",icon:"map-outline",type:"consumable",description:"Reveals secrets.",sellValue:5,rarity:"common",quantity:1},herb:{id:"herb",name:"Magic Herb",icon:"leaf-outline",type:"material",description:"Medicinal plant.",sellValue:2,rarity:"common",quantity:1},skull:{id:"skull",name:"Cursed Skull",icon:"skull-outline",type:"material",description:"Spooky vibes.",sellValue:200,rarity:"legendary",quantity:1}}}getInventory(){let e=localStorage.getItem(this.STORAGE_KEY);return e?JSON.parse(e):[]}getGold(){return parseInt(localStorage.getItem(this.GOLD_KEY)||"0",10)}addGold(e){let t=this.getGold();localStorage.setItem(this.GOLD_KEY,(t+e).toString())}addItem(e){let t=this.getInventory(),n=t.find(i=>i.id.split("_")[0]===e.id.split("_")[0]);n?n.quantity+=e.quantity:t.push(e),this.achievementService.notifyInventoryUpdate(t),this.saveInventory(t)}removeItem(e,t=1){let n=this.getInventory(),i=n.findIndex(a=>a.id.split("_")[0]===e.split("_")[0]);i>-1&&(n[i].quantity-=t,n[i].quantity<=0&&n.splice(i,1),this.saveInventory(n))}generateLoot(e){let t=e==="high"?100:e==="medium"?50:10;this.addGold(t);let n=Math.random(),i=null;return n>.5&&(e==="low"&&(i=this.LOOT_TABLE.potion),e==="medium"&&(i=this.LOOT_TABLE.gem),e==="high"&&(i=this.LOOT_TABLE.sword)),i?(this.addItem(h(m({},i),{quantity:1})),{gold:t,item:i.name}):{gold:t,item:null}}saveInventory(e){localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e))}getRandomItems(e,t){let n=Math.floor(Math.random()*(t-e+1))+e,i=[],a=Object.keys(this.LOOT_TABLE);for(let o=0;o<n;o++){let u=a[Math.floor(Math.random()*a.length)],d=m({},this.LOOT_TABLE[u]);d.id=d.id+"_"+Math.random().toString(36).substr(2,9),i.push(d)}return i}};r.\u0275fac=function(t){return new(t||r)(c(g))},r.\u0275prov=l({token:r,factory:r.\u0275fac,providedIn:"root"});let s=r;return s})();var g=(()=>{let r=class r{constructor(e){this.injector=e,this.STORAGE_KEY="user_achievements_v2",this.ITEM_POOL=["hammer","key","potion","shield","map","herb","skull"],this.MASTER_ACHIEVEMENTS=[{id:"quest_t1",groupId:"quest_chain",tier:1,title:"First Steps",description:"Complete your first habit",type:"count",targetValue:1,currentValue:0,xpReward:25,completed:!1,claimed:!1},{id:"streak_t1",groupId:"streak_chain",tier:1,title:"Consistency",description:"Reach a 3-day streak",type:"streak",targetValue:3,currentValue:0,xpReward:50,completed:!1,claimed:!1},{id:"bounty_intro",groupId:"bounty_board",tier:1,title:"Scavenger Hunt",description:"Collect 1 Hammer",type:"collection",targetId:"hammer",targetValue:1,currentValue:0,xpReward:30,completed:!1,claimed:!1}],this.achievements=[],this.lastUnlocked=y(null),this.loadData()}getVisibleAchievements(){let e=[];return[...new Set(this.achievements.map(n=>n.groupId))].forEach(n=>{let a=this.achievements.filter(o=>o.groupId===n).sort((o,u)=>o.tier-u.tier).find(o=>!o.claimed);a&&e.push(a)}),e}getTrophyCase(){return this.achievements.filter(e=>e.claimed).reverse()}claim(e){let t=this.achievements.find(n=>n.id===e);return t&&t.completed&&!t.claimed?(t.type==="collection"&&t.targetId&&this.injector.get(f).removeItem(t.targetId,t.targetValue),t.claimed=!0,this.generateNextStep(t),this.saveData(),t.xpReward):0}generateNextStep(e){e.type==="streak"||e.type==="count"?this.createScalingAchievement(e):e.groupId==="bounty_board"&&this.createRandomBounty(e)}createScalingAchievement(e){let t=e.tier+1,n=Math.ceil(e.targetValue*1.5),i=e.xpReward+25,a={id:`${e.groupId}_t${t}`,groupId:e.groupId,tier:t,title:this.getDynamicTitle(e.type,t),description:`Reach ${n} ${e.type==="streak"?"day streak":"total quests"}`,type:e.type,targetValue:n,currentValue:e.type==="count"?e.currentValue:0,xpReward:i,completed:!1,claimed:!1,isDynamic:!0};this.achievements.push(a)}createRandomBounty(e){let t=e.tier+1,n=this.ITEM_POOL[Math.floor(Math.random()*this.ITEM_POOL.length)],i=Math.floor(Math.random()*3)+1,a=30+i*10,o={id:`bounty_${Date.now()}`,groupId:"bounty_board",tier:t,title:`Bounty: ${n.toUpperCase()}`,description:`Collect ${i} ${n}(s)`,type:"collection",targetId:n,targetValue:i,currentValue:0,xpReward:a,completed:!1,claimed:!1,isDynamic:!0};this.achievements.push(o)}getDynamicTitle(e,t){return e==="streak"?t===2?"Unstoppable":t===3?"On Fire":t===4?"Legendary Consistency":`Streak Master ${t}`:e==="count"?t===2?"Getting Serious":t===3?"Quest Master":t===4?"Habit Hero":`Veteran Tier ${t}`:`Tier ${t}`}notifyHabitComplete(e){let t=!1,n=(i,a)=>{!i.completed&&a>=i.targetValue?(i.currentValue=a,i.completed=!0,this.lastUnlocked.set(i),t=!0):!i.completed&&a>i.currentValue&&(i.currentValue=a,t=!0)};this.achievements.filter(i=>i.type==="count").forEach(i=>{n(i,i.currentValue+1)}),this.achievements.filter(i=>i.type==="streak").forEach(i=>{n(i,e)}),t&&this.saveData()}notifyInventoryUpdate(e){let t=!1;console.log("Notifying inventory update for achievements. Current items:",e),this.achievements.filter(n=>n.type==="collection"&&!n.completed).forEach(n=>{let i=e.find(a=>a.id.split("_")[0]===n.targetId);console.log(`Checking collection quest ${i}`),console.log(`Achievement ${n.targetId} requires ${n.targetValue}, player has ${i?i.quantity:0}`),i&&(console.log(`Checking collection quest ${n.title}: found ${i.quantity} of ${n.targetValue} ${n.targetId}`),n.currentValue=i.quantity,n.currentValue>=n.targetValue&&(n.completed=!0,this.lastUnlocked.set(n)),t=!0)}),t&&this.saveData()}loadData(){let e=localStorage.getItem(this.STORAGE_KEY);e?(this.achievements=JSON.parse(e),this.MASTER_ACHIEVEMENTS.forEach(t=>{this.achievements.find(n=>n.id===t.id)||this.achievements.push(t)})):(this.achievements=JSON.parse(JSON.stringify(this.MASTER_ACHIEVEMENTS)),this.saveData())}saveData(){localStorage.setItem(this.STORAGE_KEY,JSON.stringify(this.achievements))}};r.\u0275fac=function(t){return new(t||r)(c(p))},r.\u0275prov=l({token:r,factory:r.\u0275fac,providedIn:"root"});let s=r;return s})();export{g as a,f as b};
