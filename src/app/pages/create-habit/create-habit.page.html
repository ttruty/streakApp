<ion-header [translucent]="true" class="ion-no-border">
  <ion-toolbar>
    <ion-title>New Quest</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">

  <ion-segment [(ngModel)]="habitType" mode="ios" class="custom-segment">
    <ion-segment-button value="regular">
      <ion-label>Regular Habit</ion-label>
    </ion-segment-button>
    <ion-segment-button value="random">
      <ion-label>Random Event</ion-label>
    </ion-segment-button>
  </ion-segment>

  <div class="form-container">
    <ion-item class="input-item">
      <ion-label position="stacked">Quest Title</ion-label>
      <ion-input [(ngModel)]="habitName" placeholder="e.g. Slay the Dragon"></ion-input>
    </ion-item>

    <div class="split-row">

      <ion-item class="input-item">
        <ion-label position="stacked">Stat</ion-label>
        <ion-select [(ngModel)]="selectedStat" interface="popover">
          <ion-select-option value="strength">STRENGTH</ion-select-option>
          <ion-select-option value="intelligence">INTELLIGENCE</ion-select-option>
          <ion-select-option value="constitution">CONSTITUTION</ion-select-option>
          <ion-select-option value="dexterity">DEXTERITY</ion-select-option>
          <ion-select-option value="charisma">CHARISMA</ion-select-option>
        </ion-select>
      </ion-item>

      <ion-item class="input-item">
        <ion-label position="stacked">Difficulty</ion-label>
        <ion-select [(ngModel)]="selectedDifficulty" interface="popover">
          <ion-select-option value="easy">Easy</ion-select-option>
          <ion-select-option value="medium">Medium</ion-select-option>
          <ion-select-option value="hard">Hard</ion-select-option>
        </ion-select>
      </ion-item>

    </div>

    <div class="visual-row">

      <div class="visual-card" (click)="toggleIconPicker()">
        <span class="label">Icon</span>
        <div class="visual-content">
          <ion-icon [name]="selectedIcon"></ion-icon>
          <span class="value-text">{{ selectedIcon }}</span>
        </div>
      </div>

      <div class="visual-card relative-card">
        <span class="label">Reward</span>

        <ion-select [(ngModel)]="lootLevel" interface="action-sheet" class="overlay-select">
          <ion-select-option value="low">Low (Common)</ion-select-option>
          <ion-select-option value="medium">Medium (Rare)</ion-select-option>
          <ion-select-option value="high">High (Legendary)</ion-select-option>
        </ion-select>

        <div class="visual-content" [ngClass]="lootLevel">
          <ion-icon name="gift" *ngIf="lootLevel === 'low'"></ion-icon>
          <ion-icon name="sparkles" *ngIf="lootLevel === 'medium'"></ion-icon>
          <ion-icon name="trophy" *ngIf="lootLevel === 'high'"></ion-icon>
          <span class="value-text">{{ lootLevel | titlecase }}</span>
        </div>
      </div>

    </div>

    <div class="icon-grid-wrapper" *ngIf="isIconPickerExpanded">
      <div class="icon-grid">
        <div *ngFor="let icon of availableIcons" class="icon-option"
             [class.selected]="selectedIcon === icon" (click)="selectIcon(icon)">
          <ion-icon [name]="icon"></ion-icon>
        </div>
      </div>
    </div>

    <div *ngIf="habitType === 'regular'" class="frequency-section">
      <ion-item class="input-item">
        <ion-label position="stacked">Frequency</ion-label>
        <ion-select [(ngModel)]="frequency" interface="popover">
          <ion-select-option value="daily">Daily</ion-select-option>
          <ion-select-option value="weekly">Weekly</ion-select-option>
        </ion-select>
      </ion-item>
    </div>

    <div *ngIf="habitType === 'random'">
      <div class="info-box">
        <ion-icon name="dice-outline"></ion-icon>
        <p>Random events will pop up unexpectedly based on your settings.</p>
      </div>

      <ion-item class="input-item">
        <ion-label position="stacked">Occurrence (1-5)</ion-label>
        <ion-input
          type="number"
          [(ngModel)]="randomCount"
          min="1"
          max="5"
          placeholder="e.g. 3">
        </ion-input>
      </ion-item>

      <ion-item class="input-item">
        <ion-label position="stacked">Timeframe</ion-label>
        <ion-select [(ngModel)]="randomPeriod" interface="popover">
          <ion-select-option value="day">Per Day</ion-select-option>
          <ion-select-option value="week">Per Week</ion-select-option>
        </ion-select>
      </ion-item>
    </div>

  </div>

</ion-content>

<ion-footer class="ion-no-border">
  <ion-toolbar class="ion-padding">
    <ion-button expand="block" (click)="saveHabit()" [disabled]="!habitName" shape="round">
      Create Habit
    </ion-button>
  </ion-toolbar>
</ion-footer>
